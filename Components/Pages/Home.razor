@page "/"
@using findajob.Models
@using findajob.Services
@using Microsoft.EntityFrameworkCore
@inject JobService JobService

<PageTitle>FindAJob.bg</PageTitle>

@* HERO SECTION *@
<MudPaper Elevation="0" Class="py-16 px-4 mb-8" 
          Style="background: linear-gradient(135deg, #00f0ff 0%, #0080ff 100%); color: white; text-align: center;">
    
    <MudText Typo="Typo.h2" Class="mb-4" Style="font-weight: 900; letter-spacing: -1px;">
        Find Your Next Big Thing
    </MudText>
    <MudText Typo="Typo.h5" Class="mb-8" Style="opacity: 0.9;">
        The most efficient job board for Bulgarian tech talent.
    </MudText>

    @* THE SEARCH BAR *@
    <MudGrid Justify="Justify.Center">
        <MudItem xs="12" sm="8" md="6">
            <div class="d-flex gap-2">
                <MudTextField @bind-Value="_searchText" 
                              Placeholder="Search jobs (e.g. .NET Developer)..." 
                              Variant="Variant.Outlined" 
                              Style="background: rgba(255,255,255,0.15); color: white; border: 1px solid white;"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Search"
                              OnKeyDown="@HandleEnterKey" /> 

                <MudButton Variant="Variant.Filled" 
                           Color="Color.Secondary" 
                           Size="Size.Large"
                           OnClick="PerformSearch"
                           Style="font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    SEARCH
                </MudButton>
            </div>
        </MudItem>
    </MudGrid>
</MudPaper>

@* JOB LISTINGS *@
<MudContainer MaxWidth="MaxWidth.Large">
    <MudText Typo="Typo.h4" Class="mb-6">Recent Job Openings</MudText>

    @if (_isLoading)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    }
    else if (_jobs.Any())
    {
        <MudGrid>
            @foreach (var job in _jobs)
            {
                <MudItem xs="12" md="6" lg="4">
                    <MudCard Elevation="3" Class="h-100" Style="border-left: 5px solid #00f0ff; background: #1a1a1a;">
                        <MudCardContent>
                            <MudText Typo="Typo.h6" Style="color: #00f0ff;">@job.Title</MudText>
                            <MudText Typo="Typo.subtitle2" Class="mb-2" Style="color: #ccc;">@job.Company</MudText>
                            <MudText Typo="Typo.body2" Style="color: #888;">
                                @(job.Description.Length > 100 ? job.Description.Substring(0, 97) + "..." : job.Description)
                            </MudText>
                        </MudCardContent>
                        <MudCardActions>
                            <MudButton Href="@($"/job/{job.Id}")" Variant="Variant.Text" Color="Color.Primary">
                                DETAILS
                            </MudButton>
                        </MudCardActions>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>
    }
    else
    {
        <MudAlert Severity="Severity.Info" Variant="Variant.Outlined" Class="mt-4" 
                  Style="border-color: #00f0ff; color: #00f0ff;">
            NO_DATA_FOUND // TRY_NEW_PARAMETERS
        </MudAlert>
    }
</MudContainer>

@code {
    private List<JobPosting> _jobs = new();
    private string _searchText = "";
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await PerformSearch();
    }

    private async Task PerformSearch()
    {
        _isLoading = true;
        _jobs = await JobService.SearchJobsAsync(_searchText);
        _isLoading = false;
    }
    
    // Allows pressing "Enter" in the text box to search
    private async Task HandleEnterKey(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await PerformSearch();
        }
    }
}
